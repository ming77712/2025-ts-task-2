import{f as L,s as A,g,h as p,c as n,u as d,a as t,d as h,w as f,r as V,F as x,j as k,z,A as $,t as a,e as u,o as i}from"./index-8esUYsfs.js";import{S as j,A as B}from"./autoplay-CcLt2_l8.js";import{a as P}from"./order-DHVZLeO6.js";import{a as U}from"./products-ChNhoPpm.js";import{u as W}from"./cartStore-Bq9wxhJJ.js";const q={class:"container"},D={key:0,class:"min-vh-100 d-flex flex-column justify-content-center align-items-center"},R={class:"my-6"},E={key:1,class:"mt-3"},F={class:"row"},M={class:"col-md-8"},G={class:"table"},O={class:"border-bottom border-top"},H={scope:"row",class:"border-0 px-0 font-weight-normal py-4"},J=["src","alt"],K={class:"mb-0 fw-bold ms-3 d-inline-block"},Q={class:"border-0 align-middle",style:{"max-width":"160px"}},X={class:"input-group pe-5"},Y={class:"input-group-prepend"},Z=["onClick","disabled"],I=["value"],tt={class:"input-group-append"},st=["onClick","disabled"],ot={class:"border-0 align-middle"},et={class:"mb-0 ms-auto"},lt={class:"border-0 align-middle"},nt=["onClick","disabled"],dt={class:"input-group w-50 mb-3"},at={class:"input-group-append"},it=["disabled"],rt={class:"col-md-4"},ct={class:"border p-4 mb-4"},pt={class:"table text-muted border-bottom"},ut={class:"text-end border-0 px-0 pt-4"},bt={class:"d-flex justify-content-between mt-4"},mt={class:"mb-0 h4 fw-bold"},_t={class:"my-5"},ht={class:"swiper-wrapper"},ft={class:"card border-0 mb-4 position-relative position-relative"},yt=["src","alt"],vt={class:"card-body p-0"},wt={class:"mb-0 mt-3"},gt={class:"card-text mb-0"},xt={class:"text-muted"},At=L({__name:"CartView",setup(kt){const b=W(),{cart:r,isUpdating:y,isDeleting:C}=A(b);g(()=>{T()});const m=p(null);g(()=>{m.value&&new j(m.value,{modules:[B],loop:!0,autoplay:{delay:2500,disableOnInteraction:!1},slidesPerView:2,spaceBetween:10,breakpoints:{767:{slidesPerView:3,spaceBetween:30}}})});const T=async()=>{try{const e=await U();v.value=e.data.products}catch{alert("取得產品列表失敗")}},v=p([]),w=async(e,s)=>{let l=s.qty;e==="plus"?l++:l--,b.updataCartItem({id:s.id,product_id:s.product.id,qty:l})},S=async e=>{b.deleteCartItem(e)},c=p(""),_=p(!1),N=async()=>{if(c.value.trim())try{_.value=!0,await P(c.value)}catch{alert("套用優惠券失敗，優惠券已過期或不存在")}finally{_.value=!1}};return(e,s)=>{const l=V("RouterLink");return i(),n("div",q,[d(r)?.carts.length===0?(i(),n("div",D,[s[2]||(s[2]=t("p",{class:"text-center"},"目前購物車還沒有任何商品",-1)),t("div",R,[h(l,{to:"/products",class:"btn btn-lg btn-dark rounded-3"},{default:f(()=>[...s[1]||(s[1]=[u("前往逛逛",-1)])]),_:1})])])):(i(),n("div",E,[s[14]||(s[14]=t("h3",{class:"mt-3 mb-4"},"購物車",-1)),t("div",F,[t("div",M,[t("table",G,[s[6]||(s[6]=t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"border-0 ps-0"},"產品名稱"),t("th",{scope:"col",class:"border-0"},"產品數量"),t("th",{scope:"col",class:"border-0"},"價格"),t("th",{scope:"col",class:"border-0"})])],-1)),t("tbody",null,[(i(!0),n(x,null,k(d(r)?.carts,o=>(i(),n("tr",O,[t("th",H,[t("img",{src:o.product.imageUrl,alt:o.product.title,style:{width:"72px",height:"72px","object-fit":"cover"}},null,8,J),t("p",K,a(o.product.title),1)]),t("td",Q,[t("div",X,[t("div",Y,[t("button",{onClick:()=>w("minus",o),disabled:o.qty===1||d(y),class:"btn btn-outline-dark border-0 py-2",type:"button",id:"button-addon1"},[...s[3]||(s[3]=[t("i",{class:"fas fa-minus"},null,-1)])],8,Z)]),t("input",{type:"text",class:"form-control border-0 text-center my-auto shadow-none",readonly:"","aria-label":"Example text with button addon","aria-describedby":"button-addon1",value:o.qty},null,8,I),t("div",tt,[t("button",{onClick:()=>w("plus",o),disabled:d(y),class:"btn btn-outline-dark border-0 py-2",type:"button"},[...s[4]||(s[4]=[t("i",{class:"fas fa-plus"},null,-1)])],8,st)])])]),t("td",ot,[t("p",et,"NT$"+a(o.final_total.toLocaleString("zh-TW")),1)]),t("td",lt,[t("button",{onClick:()=>S(o.id),disabled:d(C),class:"btn btn-outline-dark border-0 py-2",type:"button"},[...s[5]||(s[5]=[t("i",{class:"fas fa-times"},null,-1)])],8,nt)])]))),256))])]),t("div",dt,[z(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>c.value=o),type:"text",class:"form-control rounded-0 border-bottom border-top-0 border-start-0 border-end-0 shadow-none",placeholder:"折扣碼"},null,512),[[$,c.value]]),t("div",at,[t("button",{onClick:N,disabled:_.value,class:"btn btn-outline-dark border-bottom border-top-0 border-start-0 border-end-0 rounded-0",type:"button",id:"button-addon2"},[...s[7]||(s[7]=[t("i",{class:"fas fa-paper-plane"},null,-1)])],8,it)])])]),t("div",rt,[t("div",ct,[s[12]||(s[12]=t("h4",{class:"fw-bold mb-4"},"訂單資訊",-1)),t("table",pt,[t("tbody",null,[t("tr",null,[s[8]||(s[8]=t("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"},"小計",-1)),t("td",ut," NT$"+a(d(r)?.total.toLocaleString("zh-TW")),1)]),s[9]||(s[9]=t("tr",null,[t("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 font-weight-normal"},"付款方式"),t("td",{class:"text-end border-0 px-0 pt-0 pb-4"},"ApplePay")],-1))])]),t("div",bt,[s[10]||(s[10]=t("p",{class:"mb-0 h4 fw-bold"},"總計",-1)),t("p",mt,"NT$"+a(d(r)?.final_total.toLocaleString("zh-TW")),1)]),h(l,{to:"/checkout",class:"btn btn-dark w-100 mt-4"},{default:f(()=>[...s[11]||(s[11]=[u("前往結帳",-1)])]),_:1})])])]),t("div",_t,[s[13]||(s[13]=t("h3",{class:"fw-bold"},"你可能會喜歡的植栽",-1)),t("div",{ref_key:"swiperContainer",ref:m,class:"swiper mt-4 mb-5"},[t("div",ht,[(i(!0),n(x,null,k(v.value,o=>(i(),n("div",{key:o.id,class:"swiper-slide"},[t("div",ft,[t("img",{src:o.imageUrl,class:"card-img-top object-fit-cover rounded-0",style:{height:"280px"},alt:o.title},null,8,yt),t("div",vt,[t("h4",wt,[h(l,{to:`/products/${o.id}`},{default:f(()=>[u(a(o.title),1)]),_:2},1032,["to"])]),t("p",gt,[u(" NT$"+a(o.price.toLocaleString("zh-TW"))+" ",1),t("span",xt,[t("del",null,"NT$"+a(o.origin_price.toLocaleString("zh-TW")),1)])])])])]))),128))])],512)])]))])}}});export{At as default};
