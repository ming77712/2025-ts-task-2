import{f as q,h as r,s as B,i as y,c as o,y as c,u as m,F as _,a as e,j as z,t as p,C as A,z as v,A as b,d as D,w as R,r as F,e as S,D as W,o as a}from"./index-8esUYsfs.js";import{b as E,c as M}from"./order-DHVZLeO6.js";import{u as O}from"./cartStore-Bq9wxhJJ.js";const G={class:"container"},H={class:"row justify-content-center"},J={class:"col-md-10"},K={key:0,class:"fw-bold mb-4 pt-3"},Q={key:1,class:"fw-bold mb-4 pt-3"},X={class:"row flex-row-reverse justify-content-center pb-5"},Y={class:"col-md-4"},Z={class:"border p-4 mb-4"},I={class:"d-flex flex-column justify-content-center gap-2"},ee=["src","alt"],te={class:"w-100"},se={class:"d-flex justify-content-between"},le={class:"mb-0 fw-bold"},oe={class:"mb-0"},ae={class:"mb-0 fw-bold"},ne={class:"table mt-4 border-top border-bottom text-muted"},re={class:"text-end border-0 px-0 pt-4"},de={class:"d-flex justify-content-between mt-4"},ie={class:"mb-0 h4 fw-bold"},ue={class:"col-md-6"},ce={class:"mb-2"},me={key:0,class:"text-danger small mt-1"},pe={class:"mb-2"},ve={key:0,class:"text-danger small mt-1"},be={class:"mb-2"},fe={key:0,class:"text-danger small mt-1"},ye={class:"mb-2"},_e={key:0,class:"text-danger small mt-1"},xe={class:"mb-2"},he={key:1,class:"card rounded-0"},we={class:"d-flex flex-column-reverse flex-md-row mt-4 justify-content-between align-items-md-center align-items-end w-100"},ge=["disabled"],ke=["disabled"],Ne=q({__name:"CheckoutView",setup(Ve){const N=W(),d=r(1),T=O(),{cart:i}=B(T),f=r(null),s=r({email:"",name:"",tel:"",address:"",message:""}),g=r(null),u=r(!1),j=()=>{u.value=!0,g.value?.click()},x=r(!1),L=async()=>{try{x.value=!0;const{message:n,...t}=s.value,w=await M({user:t,message:n});f.value=w.data.orderId,d.value=2}catch{alert("訂單建立失敗")}finally{x.value=!1}},k=y(()=>{const n=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;return s.value.email&&n.test(s.value.email.trim())}),V=y(()=>s.value.name&&s.value.name.trim()!==""),C=y(()=>{const n=/^09\d{8}$/;return s.value.tel&&n.test(s.value.tel)}),P=y(()=>s.value.address&&s.value.address.trim()!==""),U=()=>{if(f.value){d.value=2;return}j()},h=r(!1),$=async()=>{if(f.value)try{h.value=!0,await E(f.value),N.push("/checkout-success")}catch{alert("付款失敗")}finally{h.value=!1}};return(n,t)=>{const w=F("RouterLink");return a(),o("div",G,[m(i)?.carts&&m(i)?.carts.length>0?(a(),o(_,{key:0},[e("div",H,[e("div",J,[d.value===1?(a(),o("h3",K,"輸入結帳資訊")):(a(),o("h3",Q,"選擇付款方式"))])]),e("div",X,[e("div",Y,[e("div",Z,[e("div",I,[(a(!0),o(_,null,z(m(i)?.carts,l=>(a(),o("div",{key:l.id,class:"d-flex"},[e("img",{src:l.product.imageUrl,alt:l.product.title,class:"me-2",style:{width:"48px",height:"48px","object-fit":"cover"}},null,8,ee),e("div",te,[e("div",se,[e("p",le,p(l.product.title),1),e("p",oe,"NT$"+p(l.final_total.toLocaleString("zh-TW")),1)]),e("p",ae,"x"+p(l.qty),1)])]))),128))]),e("table",ne,[e("tbody",null,[e("tr",null,[t[6]||(t[6]=e("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"},"小計",-1)),e("td",re," NT$"+p(m(i)?.total.toLocaleString("zh-TW")),1)]),t[7]||(t[7]=e("tr",null,[e("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 font-weight-normal"},"付款方式"),e("td",{class:"text-end border-0 px-0 pt-0 pb-4"},"ApplePay")],-1))])]),e("div",de,[t[8]||(t[8]=e("p",{class:"mb-0 h4 fw-bold"},"總計",-1)),e("p",ie,"NT$"+p(m(i)?.final_total.toLocaleString("zh-TW")),1)])])]),e("div",ue,[d.value===1?(a(),o("form",{key:0,onSubmit:A(L,["prevent"])},[e("div",ce,[t[9]||(t[9]=e("label",{for:"email",class:"text-muted mb-0"},"電子信箱",-1)),v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.email=l),required:"",type:"email",class:"form-control",id:"email",placeholder:"example@gmail.com"},null,512),[[b,s.value.email]]),!k.value&&u.value?(a(),o("span",me," 請輸入正確的電子信箱 ")):c("",!0)]),e("div",pe,[t[10]||(t[10]=e("label",{for:"name",class:"text-muted mb-0"},"姓名",-1)),v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.name=l),required:"",type:"text",class:"form-control",id:"name",placeholder:"王漂亮"},null,512),[[b,s.value.name]]),!V.value&&u.value?(a(),o("span",ve," 請輸入姓名 ")):c("",!0)]),e("div",be,[t[11]||(t[11]=e("label",{for:"tel",class:"text-muted mb-0"},"手機",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.tel=l),required:"",type:"text",class:"form-control",id:"tel",placeholder:"0912345678"},null,512),[[b,s.value.tel]]),!C.value&&u.value?(a(),o("span",fe," 請輸入正確的手機號碼 ")):c("",!0)]),e("div",ye,[t[12]||(t[12]=e("label",{for:"address",class:"text-muted mb-0"},"地址",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.address=l),required:"",type:"text",class:"form-control",id:"address",placeholder:"高雄市新興區"},null,512),[[b,s.value.address]]),!P.value&&u.value?(a(),o("span",_e," 請輸入正確的地址 ")):c("",!0)]),e("div",xe,[t[13]||(t[13]=e("label",{for:"message",class:"text-muted mb-0"},"留言",-1)),v(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.message=l),class:"form-control",rows:"3",id:"message",placeholder:"六角學院，只要你不放棄，我們就不放棄你 ... "},null,512),[[b,s.value.message]])]),e("button",{ref_key:"submitBtn",ref:g,type:"submit",class:"d-none"},null,512)],32)):(a(),o("div",he,[...t[14]||(t[14]=[e("div",{class:"card-header bg-white border-0 py-3"},[e("p",{class:"mb-0 position-relative custom-checkout-label"},"Apple Pay")],-1)])])),e("div",we,[d.value===1?(a(),o(_,{key:0},[D(w,{to:"/cart",class:"text-dark mt-md-0 mt-3"},{default:R(()=>[...t[15]||(t[15]=[e("i",{class:"fas fa-chevron-left me-2"},null,-1),S("返回",-1)])]),_:1}),e("button",{onClick:U,disabled:x.value||!k.value||!V.value||!C.value||!P.value,type:"button",class:"btn btn-dark py-3 px-7"}," 下一步 ",8,ge)],64)):(a(),o(_,{key:1},[e("button",{onClick:t[5]||(t[5]=l=>d.value=1),type:"button",class:"link-dark bg-transparent border-0 mt-md-0 mt-3 p-0"},[...t[16]||(t[16]=[e("i",{class:"fas fa-chevron-left me-2"},null,-1),S("返回 ",-1)])]),e("button",{onClick:$,disabled:h.value,type:"button",class:"btn btn-dark py-3 px-7"}," 結帳 ",8,ke)],64))])])])],64)):c("",!0)])}}});export{Ne as default};
